<!-- hr_app/templates/hr/manage_crews.html -->{% extends 'base.html' %}{% block title %}Manage Crews{% endblock %}{% block content %}<h4>Manage Crews</h4><div class="mb-5">    <a href="{% url 'staff_dashboard' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Back to Dashboard</a>        <a href="{% url 'timeclock_report' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Timeclock Report</a>    <a href="{% url 'training_management' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Training Management</a>    <a href="{% url 'bulk_renew_training' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Bulk Renew Training</a>    <a href="{% url 'staff_message' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Post Message</a>    <form method="post" action="{% url 'logout' %}" style="display: inline;">        {% csrf_token %}        <button type="submit" class="btn btn-danger py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Logout</button>    </form></div><!-- Filter Crews --><h3>Filter Crews</h3><form method="get" class="mb-3">    <div class="row">        <div class="col-md-4">            <label for="crew_name">Crew Name:</label>            <input type="text" name="crew_name" id="crew_name" value="{{ request.GET.crew_name }}" class="form-control">        </div>        <div class="col-md-4">            <label for="leader_name">Crew Leader Name:</label>            <input type="text" name="leader_name" id="leader_name" value="{{ request.GET.leader_name }}" class="form-control">        </div>        <div class="col-md-4 d-flex align-items-end">            <button type="submit" class="btn btn-primary me-2">Filter</button>            <a href="{% url 'manage_crews' %}" class="btn btn-secondary">Reset</a>        </div>    </div></form><!-- Create New Crew (Collapsed) --><div class="mb-3">    <h3>        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#createCrew" aria-expanded="false" aria-controls="createCrew">            Create New Crew        </button>    </h3>    <div class="collapse" id="createCrew">        <div class="card mb-3">            <div class="card-body">                <form method="post">                    {% csrf_token %}                    {{ crew_form.as_p }}                    <input type="hidden" name="create_crew" value="1">                    <button type="submit" class="btn btn-primary">Create Crew</button>                </form>            </div>        </div>    </div></div><!-- Crew List --><h3>Existing Crews ({{ crews.count }})</h3>{% for crew in crews %}    <div class="mb-3">        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#crew{{ crew.id }}" aria-expanded="false" aria-controls="crew{{ crew.id }}">            {{ crew.name }} (Leader: {% if crew.leader %}{{ crew.leader.last_name }}, {{ crew.leader.first_name }}{% else %}None{% endif %})        </button>        <div class="collapse" id="crew{{ crew.id }}">            <div class="card mb-3">                <div class="card-body">                    <h4>{{ crew.name }}</h4>                    <p>Description: {{ crew.description|default:"None" }}</p>                    <p>Default Site: {{ crew.default_site|default:"Not set" }}</p>                    <p>State: {{ crew.get_state_display|default:"Not set" }}</p>                    <!-- Edit Crew Details -->                    <h5>Edit Crew Details (Update only what you want to change)</h5>                    <form method="post" class="mb-3">                        {% csrf_token %}                        <div class="mb-2">                            <label for="id_name_{{ crew.id }}">Name:</label>                            <input type="text" name="name" id="id_name_{{ crew.id }}" value="{{ crew.name }}" class="form-control">                        </div>                        <div class="mb-2">                            <label for="id_description_{{ crew.id }}">Description:</label>                            <textarea name="description" id="id_description_{{ crew.id }}" class="form-control">{{ crew.description }}</textarea>                        </div>                        <div class="mb-2">                            <label for="id_state_{{ crew.id }}">State:</label>                            <select name="state" id="id_state_{{ crew.id }}" class="form-control">                                <option value="" {% if not crew.state %}selected{% endif %}>---------</option>                                {% for value, label in crew_form.state.field.choices|slice:"1:" %}                                    <option value="{{ value }}" {% if crew.state == value %}selected{% endif %}>{{ label }}</option>                                {% endfor %}                            </select>                        </div>                        <div class="mb-2">                            <label for="id_default_site_{{ crew.id }}">Default Site:</label>                            <select name="default_site" id="id_default_site_{{ crew.id }}" class="form-control">                                <option value="" {% if not crew.default_site %}selected{% endif %}>---------</option>                                {% for site in crew_form.default_site.field.queryset %}                                    <option value="{{ site.id }}" {% if crew.default_site == site %}selected{% endif %}>{{ site }}</option>                                {% endfor %}                            </select>                        </div>                        <input type="hidden" name="crew_id" value="{{ crew.id }}">                        <input type="hidden" name="edit_crew" value="1">                        <button type="submit" class="btn btn-sm btn-warning">Update Crew</button>                    </form>                    <!-- Edit Leader -->                    <h5>Edit Leader</h5>                    <form method="post" class="d-inline">                        {% csrf_token %}                        <label for="leader_{{ crew.id }}">Leader:</label>                        <select name="leader" id="leader_{{ crew.id }}">                            <option value="">None</option>                            {% for user in users %}                                <option value="{{ user.id }}" {% if user == crew.leader %}selected{% endif %}>                                    {{ user.last_name }}, {{ user.first_name }}                                </option>                            {% endfor %}                        </select>                        <input type="hidden" name="crew_id" value="{{ crew.id }}">                        <input type="hidden" name="edit_leader" value="1">                        <button type="submit" class="btn btn-sm btn-warning">Update Leader</button>                    </form>                    <!-- Assign Members -->                    <h5>Assign Member</h5>                    <h3>Be sure to add Leader to Crew</h3>                    <form method="post">                        {% csrf_token %}                        {{ assignment_form.as_p }}                        <input type="hidden" name="crew_id" value="{{ crew.id }}">                        <input type="hidden" name="assign_crew" value="1">                        <button type="submit" class="btn btn-sm btn-primary">Assign</button>                    </form>                    <!-- Current Members -->                    <h5>Members</h5>                    <ul>                    {% for assignment in crew.assignments.all %}                        <li>                            {{ assignment.employee.first_name }} {{ assignment.employee.last_name }}                            {% if assignment.is_temporary %}(Temporary until {{ assignment.end_date }}){% endif %}                            <form method="post" class="d-inline">                                {% csrf_token %}                                <input type="hidden" name="assignment_id" value="{{ assignment.id }}">                                "remove_member" value="1">                                <button type="submit" class="btn btn-sm btn-danger ms-2">Remove</button>                            </form>                        </li>                    {% empty %}                        <li>No members assigned.</li>                    {% endfor %}                    </ul>                </div>            </div>        </div>    </div>{% empty %}    <p>No crews found.</p>{% endfor %}<a href="{% url 'staff_dashboard' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Back to Dashboard</a>    {% endblock %}