<!-- hr/templates/hr/employee_detail.html -->{% extends 'base.html' %}{% load tz %}{% block title %}Employee Details - {{ user.get_full_name|default:user.username }}{% endblock %}{% block content %}<h2>Employee Details: {{ user.get_full_name|default:user.username }}</h2><div class="mb-3">    <a href="{% url 'staff_dashboard' %}" class="btn btn-secondary me-2">Dashboard</a>    <form method="post" action="{% url 'logout' %}" style="display:inline;">        {% csrf_token %}        <button type="submit" class="btn btn-primary">Logout</button>    </form></div><div class="mb-3 d-flex align-items-start">    {% if user.profile.picture %}        <img src="{{ user.profile.picture.url }}" alt="{{ user.username }}'s Picture" class="img-thumbnail" style="max-width: 200px;">    {% else %}        <div class="border p-3 text-center" style="width: 200px; height: 200px;">No Picture</div>    {% endif %}    <div class="ms-3">        {% with app=user.employmentapplication_set.first %}            <p><strong>Address:</strong> {% if app %}{{ app.address_line_1 }}{% if app.address_line_2 %}, {{ app.address_line_2 }}{% endif %}, {{ app.city }}, {{ app.state }} {{ app.zip_code }}{% else %}Not provided{% endif %}</p>        {% endwith %}        <p><strong>Email:</strong> {% if user.email %}<a href="mailto:{{ user.email }}">{{ user.email }}</a>{% else %}Not provided{% endif %}</p>        <p><strong>Phone:</strong> {% if user.profile.cell_number %}<a href="tel:{{ user.profile.cell_number }}">{{ user.profile.cell_number }}</a>{% else %}Not provided{% endif %}</p>        <p><strong>Middle Initial:</strong> {{ user.profile.middle_initial|default:"Not set" }}</p>        <p><strong>Employee ID:</strong> {{ user.profile.employee_id|default:"Not set" }}</p>        <p><strong>Hire Date:</strong> {{ user.profile.hire_date|date:"Y-m-d"|default:"Not set" }}</p>        <p><strong>Pay Rate ($/hr):</strong> {{ user.profile.pay_rate|floatformat:2|default:"Not set" }}</p>        <p><strong>Termination Date:</strong> {{ user.profile.termination_date|date:"Y-m-d"|default:"Not set" }}</p>        <p><strong>Notes:</strong> {{ user.profile.notes|default:"Not set" }}</p>        {% if signed_pdf_url %}            <p><strong>Signed Application:</strong> <a href="{{ signed_pdf_url }}" target="_blank">View Signed Application PDF</a></p>        {% endif %}        <button class="btn btn-primary mt-2" type="button" data-bs-toggle="collapse" data-bs-target="#profileEditForm" aria-expanded="false" aria-controls="profileEditForm">            Edit Profile        </button>        <div class="collapse mt-2" id="profileEditForm">            <form method="post">                {% csrf_token %}                <input type="hidden" name="update_profile" value="1">                <div class="mb-2">                    <label for="id_middle_initial" class="form-label"><strong>Middle Initial:</strong></label>                    {{ profile_form.middle_initial }}                </div>                <div class="mb-2">                    <label for="id_employee_id" class="form-label"><strong>Employee ID:</strong></label>                    {{ profile_form.employee_id }}                </div>                <div class="mb-2">                    <label for="id_hire_date" class="form-label"><strong>Hire Date:</strong></label>                    {{ profile_form.hire_date }}                </div>                <div class="mb-2">                    <label for="id_pay_rate" class="form-label"><strong>Pay Rate ($/hr):</strong></label>                    {{ profile_form.pay_rate }}                </div>                <div class="mb-2">                    <label for="id_termination_date" class="form-label"><strong>Termination Date:</strong></label>                    {{ profile_form.termination_date }}                </div>                <div class="mb-2">                    <label for="id_notes" class="form-label"><strong>Notes:</strong></label>                    {{ profile_form.notes }}                </div>                {% if profile_form.errors %}                    <div class="alert alert-danger">                        <strong>Form Errors:</strong>                        <ul>                            {% for field in profile_form %}                                {% for error in field.errors %}                                    <li>{{ field.label }}: {{ error }}</li>                                {% endfor %}                            {% endfor %}                            {% for error in profile_form.non_field_errors %}                                <li>{{ error }}</li>                            {% endfor %}                        </ul>                    </div>                {% endif %}                <button type="submit" class="btn btn-success me-2">Save</button>                <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#profileEditForm">Cancel</button>            </form>        </div>    </div></div><div class="mb-3">    <form method="post" style="display:inline;">        {% csrf_token %}        <input type="hidden" name="toggle_employee" value="1">        <button type="submit" class="btn btn-{% if user.profile.is_employee %}success{% else %}secondary{% endif %}">            {{ user.profile.is_employee|yesno:"Employee,Applicant" }}        </button>    </form>    {% if user.profile.is_employee %}        <form method="post" style="display:inline; margin-left: 10px;">            {% csrf_token %}            <input type="hidden" name="toggle_active" value="1">            <button type="submit" class="btn btn-{% if user.profile.is_active %}success{% else %}danger{% endif %}">                {{ user.profile.is_active|yesno:"Active,Inactive" }}            </button>        </form>    {% endif %}    <form method="post" enctype="multipart/form-data" style="display:inline; margin-left: 10px;">        {% csrf_token %}        <input type="hidden" name="upload_picture" value="1">        <input type="file" name="picture" class="form-control d-inline-block w-auto" accept="image/*">        <button type="submit" class="btn btn-primary">Upload Picture</button>    </form></div><div class="mb-3">    <h3>Employee Stats</h3>    <p>        Sick Days: {{ stats_totals.sick_days|default:'0' }} hrs |        Tardy: {{ stats_totals.tardy_count|default:'0' }} times |        Overtime: {{ stats_totals.overtime_hours|default:'0' }} hrs |        Vacation: {{ stats_totals.vacation_hours|default:'0' }} hrs        <button class="btn btn-sm btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#statsCollapse">Details</button>    </p>    <div id="statsCollapse" class="collapse">        {% if stats %}            <table class="table">                <tr><th>Type</th><th>Date</th><th>Hours</th><th>Note</th><th>Recorded By</th><th>Recorded At</th></tr>                {% for stat in stats %}                    <tr>                        <td>{{ stat.get_stat_type_display }}</td>                        <td>{{ stat.date|localtime }}</td>                        <td>{{ stat.hours|default_if_none:'' }}</td>                        <td>{{ stat.note }}</td>                        <td>{{ stat.recorded_by.username }}</td>                        <td>{{ stat.recorded_at|localtime }}</td>                    </tr>                {% endfor %}            </table>        {% else %}            <p>No stats recorded.</p>        {% endif %}        <form method="post" class="mt-3">            {% csrf_token %}            <input type="hidden" name="record_stat" value="1">            {{ stat_form.as_p }}            <button type="submit" class="btn btn-primary">Record Stat</button>        </form>    </div></div><!-- Remaining sections unchanged --><div class="mb-3">    <h3 class="d-inline">Employee Certifications</h3>    <button class="btn btn-sm btn-primary ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#certificationsCollapse">({{ certifications.count }})</button>    <div id="certificationsCollapse" class="collapse">        {% if certifications %}            <table class="table">                <thead>                    <tr>                        <th>Certification</th>                        <th>Completion Date</th>                        <th>Expiration Date</th>                        <th>Action</th>                    </tr>                </thead>                <tbody>                {% for cert in certifications %}                    <tr {% if cert.expiration_date and cert.expiration_date < today %}class="table-danger"{% endif %}>                        <td>{{ cert.certification.name }}</td>                        <td>{{ cert.completion_date|date:"Y-m-d" }}</td>                        <td>{{ cert.expiration_date|date:"Y-m-d"|default_if_none:'N/A' }}</td>                        <td>                            <form method="post" class="d-inline">                                {% csrf_token %}                                <input type="hidden" name="renew_certification" value="1">                                <input type="hidden" name="certification_id" value="{{ cert.id }}">                                <input type="date" name="new_expiration_date" class="form-control d-inline-block w-auto" required>                                <button type="submit" class="btn btn-sm btn-success">Renew</button>                            </form>                        </td>                    </tr>                {% empty %}                    <tr><td colspan="4">No certifications recorded.</td></tr>                {% endfor %}                </tbody>            </table>        {% else %}            <p>No certifications recorded.</p>        {% endif %}        <form method="post" class="mt-3">            {% csrf_token %}            <input type="hidden" name="record_certification" value="1">            {{ certification_form.certification.label_tag }} {{ certification_form.certification }}            {{ certification_form.completion_date.label_tag }} {{ certification_form.completion_date }}            {{ certification_form.expiration_date.label_tag }} {{ certification_form.expiration_date }}            {% if certification_form.errors %}                <div class="alert alert-danger">                    <strong>Form Errors:</strong>                    <ul>                        {% for field in certification_form %}                            {% for error in field.errors %}                                <li>{{ field.label }}: {{ error }}</li>                            {% endfor %}                        {% endfor %}                        {% for error in certification_form.non_field_errors %}                            <li>{{ error }}</li>                        {% endfor %}                    </ul>                </div>            {% endif %}            <button type="submit" class="btn btn-primary">Record Certification</button>        </form>    </div></div><div class="mb-3">    <h3 class="d-inline">Hazard Reports</h3>    <button class="btn btn-sm btn-primary ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#hazardsCollapse">({{ hazard_reports.count }})</button>    <div id="hazardsCollapse" class="collapse">        {% if hazard_reports %}            <table class="table">                <tr><th>Type</th><th>Description</th><th>Photo</th><th>Reported At</th></tr>                {% for report in hazard_reports %}                    <tr>                        <td>{{ report.get_hazard_type_display }}</td>                        <td>{{ report.description }}</td>                        <td>{% if report.photo %}<a href="{{ report.photo.url }}" target="_blank">View</a>{% else %}N/A{% endif %}</td>                        <td>{{ report.reported_at|localtime }}</td>                    </tr>                {% endfor %}            </table>        {% else %}            <p>No hazard reports.</p>        {% endif %}    </div></div><div class="mb-3">    <h3 class="d-inline">Suggestions</h3>    <button class="btn btn-sm btn-primary ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#suggestionsCollapse">({{ suggestions.count }})</button>    <div id="suggestionsCollapse" class="collapse">        {% if suggestions %}            <table class="table">                <tr><th>Text</th><th>Submitted At</th></tr>                {% for suggestion in suggestions %}                    <tr>                        <td>{{ suggestion.suggestion_text }}</td>                        <td>{{ suggestion.submitted_at|localtime }}</td>                    </tr>                {% endfor %}            </table>        {% else %}            <p>No suggestions submitted.</p>        {% endif %}    </div></div><div class="mb-3">    <h3 class="d-inline">Timeclock Entries</h3>    <button class="btn btn-sm btn-primary ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#timeclockCollapse">({{ timeclock_entries.count }})</button>    <div id="timeclockCollapse" class="collapse">        {% if timeclock_entries %}            <table class="table">                <tr><th>Clock In</th><th>Clock Out</th><th>Hours</th><th>Location</th><th>Recorded At</th></tr>                {% for entry in timeclock_entries %}                    <tr>                        <td>{{ entry.clock_in|localtime|default:'N/A' }}</td>                        <td>{{ entry.clock_out|localtime|default:'N/A' }}</td>                        <td>{{ entry.hours_worked|default:'N/A' }}</td>                        <td>                            {% if entry.latitude and entry.longitude %}                                <a href="https://www.google.com/maps?q={{ entry.latitude }},{{ entry.longitude }}" target="_blank">Map</a>                            {% else %}                                N/A                            {% endif %}                        </td>                        <td>{{ entry.recorded_at|localtime }}</td>                    </tr>                {% endfor %}            </table>        {% else %}            <p>No timeclock entries.</p>        {% endif %}    </div></div>{% endblock %}