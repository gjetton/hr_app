<!-- hr_app/templates/hr/staff_dashboard.html -->{% extends 'base.html' %}{% block title %}Staff Dashboard{% endblock %}{% load form_tags %}{% block content %}<h4>Staff Dashboard</h4><div class="mb-5">    <a href="{% url 'manage_crews' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Manage Crews</a>    <a href="{% url 'timeclock_report' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Timeclock Report</a>    <a href="{% url 'training_management' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Training Management</a>    <a href="{% url 'bulk_renew_training' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Bulk Renew Training</a>    <a href="{% url 'staff_message' %}" class="btn btn-info py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Post Message</a>    <form method="post" action="{% url 'logout' %}" style="display: inline;">        {% csrf_token %}        <button type="submit" class="btn btn-danger py-2 d-block d-md-inline-block mx-1 mb-2 mb-md-0">Logout</button>    </form></div><form method="get" class="mb-2">    {{ filter_form.state.label_tag }} {{ filter_form.state }}    {{ filter_form.crew.label_tag }} {{ filter_form.crew }}    {{ filter_form.employee_search.label_tag }} {{ filter_form.employee_search|add_class:"w-50" }}    {{ filter_form.site.label_tag }} {{ filter_form.site }} <!-- Could rename label to "Jobsite" in forms.py -->    <button type="submit" class="btn btn-primary mt-2">Filter</button>    <button type="reset" class="btn btn-secondary mt-2" onclick="window.location.href='{% url 'staff_dashboard' %}'">Reset</button></form><h2>Employees</h2><button class="btn btn-primary mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#employeeList" aria-expanded="false" aria-controls="employeeList">    Show Employees ({{ employees.count }})</button><div class="collapse" id="employeeList">    <table class="table">        <thead>            <tr>                <th>Name</th>                <th>Email</th>                <th>Actions</th>            </tr>        </thead>        <tbody>        {% for employee in employees %}            <tr>                <td>{{ employee.first_name }} {{ employee.last_name }}</td>                <td>{{ employee.email }}</td>                <td><a href="{% url 'employee_detail' employee.id %}" class="btn btn-sm btn-info">View</a></td>            </tr>        {% empty %}            <tr><td colspan="3">No employees found.</td></tr>        {% endfor %}        </tbody>    </table></div><h2>Applicants</h2><button class="btn btn-primary mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#applicantList" aria-expanded="false" aria-controls="applicantList">    Show Applicants ({{ applicants.count }})</button><div class="collapse" id="applicantList">    <table class="table">        <thead>            <tr>                <th>Name</th>                <th>Email</th>                <th>Actions</th>            </tr>        </thead>        <tbody>        {% for applicant in applicants %}            <tr>                <td>{{ applicant.first_name }} {{ applicant.last_name }}</td>                <td>{{ applicant.email }}</td>                <td><a href="{% url 'employee_detail' applicant.id %}" class="btn btn-sm btn-info">View</a></td>            </tr>        {% empty %}            <tr><td colspan="3">No applicants found.</td></tr>        {% endfor %}        </tbody>    </table></div><h2>Certification Alerts</h2><button class="btn btn-primary mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#certAlerts" aria-expanded="false" aria-controls="certAlerts">    Show Certification Alerts ({{ expiring_certs.count|add:expired_certs.count }})</button><div class="collapse" id="certAlerts">    <div class="mt-2">        <h4>Expiring Soon (Within 30 Days)</h4>        <table class="table table-bordered">            <thead>                <tr>                    <th>Employee</th>                    <th>Certification</th>                    <th>Expires</th>                    <th>Dismiss</th>                </tr>            </thead>            <tbody>            {% for cert in expiring_certs %}                <tr>                    <td>{{ cert.employee.last_name }}, {{ cert.employee.first_name }}</td>                    <td>{{ cert.certification.name }}</td>                    <td>{{ cert.expiration_date }}</td>                    <td>                        <form method="post" style="display: inline;">                            {% csrf_token %}                            <input type="hidden" name="cert_id" value="{{ cert.id }}">                            <input type="checkbox" name="dismiss" onchange="this.form.submit()" class="form-check-input">                            <input type="hidden" name="dismiss_cert" value="1">                        </form>                    </td>                </tr>            {% empty %}                <tr><td colspan="4">No certifications expiring soon.</td></tr>            {% endfor %}            </tbody>        </table>        <h4 style="color: red;">Expired Certifications</h4>        <table class="table table-bordered">            <thead>                <tr>                    <th>Employee</th>                    <th>Certification</th>                    <th>Expired On</th>                    <th>Dismiss</th>                </tr>            </thead>            <tbody>            {% for cert in expired_certs %}                <tr>                    <td>{{ cert.employee.last_name }}, {{ cert.employee.first_name }}</td>                    <td>{{ cert.certification.name }}</td>                    <td>{{ cert.expiration_date }}</td>                    <td>                        <form method="post" style="display: inline;">                            {% csrf_token %}                            <input type="hidden" name="cert_id" value="{{ cert.id }}">                            <input type="checkbox" name="dismiss" onchange="this.form.submit()" class="form-check-input">                            <input type="hidden" name="dismiss_cert" value="1">                        </form>                    </td>                </tr>            {% empty %}                <tr><td colspan="4">No expired certifications.</td></tr>            {% endfor %}            </tbody>        </table>    </div></div><h2>Recent Hazard Reports</h2><button class="btn btn-primary mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#recentHazards" aria-expanded="false" aria-controls="recentHazards">    Show Recent Hazard Reports ({{ recent_hazards|length }})</button><div class="collapse" id="recentHazards">    <ul>    {% for hazard in recent_hazards %}        <li>            <a href="{% url 'hazard_report_detail' hazard.id %}">{{ hazard.user.last_name }}, {{ hazard.user.first_name }} - {{ hazard.hazard_type }} ({{ hazard.reported_at }})</a>            <form method="post" class="d-inline">                {% csrf_token %}                <input type="hidden" name="hazard_id" value="{{ hazard.id }}">                <button type="submit" name="silence_hazard" class="btn btn-sm btn-warning ms-2">Silence</button>            </form>        </li>    {% empty %}        <li>No recent hazards.</li>    {% endfor %}    </ul></div><h2>Recent Suggestions</h2><button class="btn btn-primary mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#recentSuggestions" aria-expanded="false" aria-controls="recentSuggestions">    Show Recent Suggestions ({{ recent_suggestions|length }})</button><div class="collapse" id="recentSuggestions">    <ul>    {% for suggestion in recent_suggestions %}        <li>            <a href="{% url 'suggestion_detail' suggestion.id %}">{{ suggestion.user.last_name }}, {{ suggestion.user.first_name }} - {{ suggestion.suggestion_text|truncatewords:10 }} ({{ suggestion.submitted_at }})</a>            <form method="post" class="d-inline">                {% csrf_token %}                <input type="hidden" name="suggestion_id" value="{{ suggestion.id }}">                <button type="submit" name="silence_suggestion" class="btn btn-sm btn-warning ms-2">Silence</button>            </form>        </li>    {% empty %}        <li>No recent suggestions.</li>    {% endfor %}    </ul></div>{% endblock %}